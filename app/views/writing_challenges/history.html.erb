<div class="container-header">
  <div class="container">
    <h1 id="writersmob">WritersMob</h1>
    <ul class="menu">
      <li>
        <%= link_to('Daily Challenge', daily_challenge_path, 'data-no-turbolink' => true, :style => "font-size: 18px; font-family: PTMono-Regular; font-size: 18px; text-decoration: underline; ") %>    
      </li>         
      <li><a href="/history" id="history">History</a>
      </li> 
    </ul>
    <div class="right-menu">
      <%= render 'devise/menu/login_items' %>
    </div>
  </div>
</div>

<div style="max-width: 1165px; margin: 10px auto; position: relative; padding: 10px 10px 0 10px;">
<table id="exercise-list" style="margin-left: 153px;">
		<tbody class="page">
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="http://code.highcharts.com/modules/exporting.js"></script>
    <div id="container" style="margin: 0; display: inline-block; margin-bottom: 35px;"></div>
      <span id="date-today"><%= @this_month %></span>
      <div id="words-since-signup">
        <%= current_user.words_since_signup %> 
        <span id="words-since-letters">
          Words Since <%= @signup_month_year %> 
        </span>
        <br />
        <%= current_user.words_this_month %>
        <span id="words-this-month">
          Words this month
        </span>
      </div>
      <div style="margin-left:35%;">
        <% if @start_date.to_date > current_user.signup_date.to_date %>
          <%=link_to "< Previous 30 days", "javascript:void(0);", :onclick=>"window.location = '/me/history?date=#{@start_date.beginning_of_month - 1.month}'"%>
        <%end%>
        
      </div>
		  <%= render :partial => 'past_writing_challenges_i_completed' %>
	</tbody>
</table>
</div>

<script>
  
  $(function () {
      $('#container').highcharts({
          chart: {
              type: 'column',
              height: 150,
              width: 460,
          },
          title: {
              align: 'right',
              text: '',
              style: {
                      fontSize: '24px',
                      fontFamily: 'Verdana, sans-serif',
                      color: 'red'
              }
          },
          subtitle: {
              text: ''
          },
          xAxis: {
              type: 'category',
              labels: { 
                enabled: false
              },
              minorTickLength: 0,
              tickLength: 0,
              max: <%= @max_value_for_xAxis %>,
          },
          yAxis: [{
            min: 0,
            showEmpty: false, 
            lineWidth: 0,
            minorGridLineWidth: 0,
            gridLineColor: 'transparent',
            labels: {
                enabled: false
            },
            minorTickLength: 0,
            tickLength: 0,
            title: {
              text: null
            },
            max: <%= raw @max_value_for_yaxis || 100 %>,
            plotLines: [{
                color: '#e8c1c1',
                width: 2,
                value: <%= raw @max_value_for_yaxis || 100 %>, // Need to set this probably as a var.
                label: { 
                  text: <%= raw @max_value_for_yaxis || 100 %> + ' words a day',
                  align: 'right',
                  x: -10,
                  y: -1,
                  style: {
                    color: '#e8c1c1',

                  }
                },
                zIndex: 5
            }]
          }], 
          plotOptions: { 
            series: { 
              color: '#4a90e2'
            },
          },

          legend: {
              enabled: false
          },
          tooltip: {
                formatter: function() {
                  var today = new Date();
                  var mm = today.getMonth() + 1;
                  var yyyy = today.getFullYear();
                  today = mm + '/' + (parseInt(this.x) + 1) + '/' + yyyy; 
                  return this.y + " words on " + today; 
                },
                backgroundColor: '#BFD8F5',
                borderColor: '#BFD8F5',
                shadow: false,
              style: { 
                color: '#fff', 
              }
          },
          exporting: { enabled: false },
          series: [{
              name: 'Number of words',
              data: <%= raw @challenges_this_month_hash %>,
          }],
          credits: { 
            enabled: false
          }
      });
  });
</script>
